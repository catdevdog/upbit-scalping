# ⚡ 업비트 스캘핑 자동매매 봇 v2.0

완전 자동 스캘핑을 위한 업비트 API 기반 자동매매 프로그램입니다.

## 🎯 프로그램 목적

**완전한 자동 스캘핑** - 사람의 개입 없이 24/7 자동으로 초단타 매매를 수행합니다.

## ✨ 주요 개선사항 (v2.0)

### 1. 스캘핑 전략 강화

- ✅ **호가창 분석 추가**: 스프레드, 불균형, 호가 깊이 측정
- ✅ **VWAP 기반 진입**: 거래량 가중 평균가 돌파/되돌림 판단
- ✅ **ATR 변동성 필터**: 최소 변동성 미달 시 진입 금지
- ✅ **RVOL 상대거래량**: 평균 대비 거래량 급증 감지

### 2. 수수료 최적화

- ✅ **타이트한 손절**: -0.8% → -0.5%로 조정
- ✅ **실제 수익률 계산**: 수수료 0.1% + 슬리피지 0.05% 고려
- ✅ **청산 기준 상향**:
  - 빠른 익절: 0.5% → 0.6%
  - 시간 제한 청산: 0.4% → 0.6%
  - 횡보 청산: 0.5% → 0.6%

### 3. 포지션 동기화 안정화

- ✅ **API 호출 캐싱**: 포지션/현재가 조회 캐싱으로 429 에러 방지
- ✅ **30초 주기 동기화**: 유령 포지션 및 불일치 자동 감지
- ✅ **Dust 자동 처리**: 100원 미만 소액 자동 무시

### 4. 실시간 대시보드

- ✅ **표시 수익률 vs 실제 수익률**: 수수료 차감 전후 병기
- ✅ **ATR 변동성 표시**: 진입 가능 변동성 실시간 확인
- ✅ **호가창 상태**: 스프레드, 불균형 정보 제공

## 🚀 설치 및 실행

### 1. 의존성 설치

```bash
npm install
```

### 2. 환경변수 설정

```bash
cp .env.example .env
# .env 파일을 열어 API 키 입력
```

### 3. 실행

```bash
npm start
```

## 📊 스캘핑 전략 상세

### 진입 조건 (모두 충족 필요)

#### 1. ATR 변동성 필터 (필수)

- 1~3분 ATR ≥ 0.3%
- 변동성 부족 시 진입 금지

#### 2. 전략 신호 (4가지 중 조합)

**RSI 전략**

- RSI < 35: 과매도
- RSI 반등: 35 돌파 시
- RSI 급등: 5 이상 증가

**거래량 전략**

- 거래량 비율 ≥ 1.5x
- RVOL ≥ 1.5
- 가격 상승 동반 (>0.1%)

**호가창 전략**

- 스프레드 ≤ 2틱
- 불균형 ≥ 20% (매수 우세)
- 베스트 호가 매수 비율 ≥ 60%

**캔들 패턴 전략**

- 연속 양봉 (2~3개)
- 급등 (≥0.5%)
- VWAP 이격도 (-0.5% ~ +0.5%)

#### 3. 시장 상황 필터

- 변동성 정상 범위
- 거래량 증가 추세
- 단기 상승 모멘텀

### 청산 조건 (우선순위 순)

1. **손절**: -0.5% (수수료 포함 시 -0.6%)
2. **익절**: +0.8%
3. **빠른 익절**: +0.6% (수수료 제외 시 +0.5%)
4. **트레일링 스탑**: 최고가 대비 -0.25%
5. **시간 제한**:
   - 180초 초과 + 손실: 강제 청산
   - 120초 초과 + 0.6% 이상 수익: 청산
6. **모멘텀 소멸**: 20초간 0.08% 미만 변동 + 0.6% 이상 수익
7. **횡보**: 60초간 0.1% 미만 변동 + 0.6% 이상 수익
8. **역추세**: RSI 과매수(70) 또는 진입 신호 소멸 + 순수익 확보

## 📋 환경변수 설명

### 필수 설정

```bash
UPBIT_ACCESS_KEY=            # 업비트 API Access Key
UPBIT_SECRET_KEY=            # 업비트 API Secret Key
MARKET=KRW-BTC              # 거래 마켓
```

### 스캘핑 최적화 설정

```bash
# 손절/익절
STOP_LOSS_PERCENT=-0.5      # 손절 기준 (타이트)
QUICK_PROFIT_PERCENT=0.6    # 빠른 익절 (수수료 고려)

# 청산 기준
MIN_PROFIT_FOR_TIME_EXIT=0.6  # 시간 제한 청산 최소 수익
SIDEWAYS_EXIT_THRESHOLD=0.6   # 횡보 청산 최소 수익

# 변동성 필터
MIN_ATR_THRESHOLD=0.3       # 최소 ATR (진입 조건)

# 호가창 분석
MAX_SPREAD_TICKS=2          # 최대 허용 스프레드
MIN_IMBALANCE=0.2           # 최소 불균형 (20%)
ORDERBOOK_DEPTH=10          # 분석 호가 깊이
```

### 전략 활성화

```bash
STRATEGY_RSI=true           # RSI 전략
STRATEGY_VOLUME=true        # 거래량 전략
STRATEGY_ORDERBOOK=true     # 호가창 전략 (개선됨)
STRATEGY_CANDLE=true        # 캔들 패턴 전략
```

## 🔧 주요 파일 구조

```
src/
├── config/
│   └── env.js              # 환경 설정 (개선됨)
├── strategies/
│   ├── index.js            # 전략 통합 (ATR 필터 추가)
│   └── scalping.js         # 스캘핑 전략 (호가창/VWAP/ATR)
├── trading/
│   ├── executor.js         # 거래 실행 (캐싱 추가)
│   ├── position.js         # 포지션 관리
│   └── riskManager.js      # 리스크 관리 (수수료 고려)
├── utils/
│   ├── indicators.js       # 기술 지표 (VWAP/ATR 추가)
│   └── cache.js            # API 캐싱 관리
└── index.js                # 메인 실행 파일
```

## 🔍 개선 사항 상세

### 1. 매수 타이밍 개선

**변경 전**:

- RSI, Volume, Candle 3가지만 사용
- 호가창 분석 비활성화
- 변동성 필터 없음

**변경 후**:

- 호가창 분석 활성화 (스프레드/불균형/깊이)
- ATR 변동성 필터 추가 (최소 0.3%)
- VWAP 이격도 판단
- RVOL 상대거래량 측정

### 2. 매도 로직 개선

**변경 전**:

- 손절 -0.8%
- 시간 제한 청산 0.4%
- 수수료 미고려

**변경 후**:

- 손절 -0.5% (타이트)
- 모든 청산 기준 0.6%로 상향
- 실제 수익률 = 표시 수익률 - 0.1% (수수료) - 0.05% (슬리피지)

### 3. 포지션 동기화 개선

**변경 전**:

- 매번 API 호출 (429 에러 위험)
- 30초 동기화 + 매수 후 15초 재시도 충돌

**변경 후**:

- 포지션 조회 2초 캐싱
- 현재가 조회 0.5초 캐싱
- 매수/매도 후 캐시 무효화

### 4. 대시보드 정보 개선

**변경 전**:

- 표시 수익률만 표시
- 전략 신호만 표시

**변경 후**:

- 표시 수익률 + 실제 수익률 병기
- ATR 변동성 표시
- 호가창 상태 (스프레드/불균형) 표시

## 📈 기대 효과

1. **진입 정확도 향상**: ATR + 호가창 분석으로 불리한 시점 진입 방지
2. **수익률 개선**: 수수료+슬리피지 고려한 청산 기준으로 실질 수익 확대
3. **안정성 강화**: API 캐싱으로 429 에러 방지, 포지션 동기화 안정화
4. **정보 투명성**: 실제 수익률 표시로 성과 정확히 파악

## ⚠️ 주의사항

- 암호화폐 투자는 고위험이며 원금 손실 가능성이 있습니다
- 소액으로 충분히 테스트 후 사용하세요
- API 호출 제한: 초당 10회, 분당 600회
- 최소 주문 금액: 5,000원
- 업비트 점검 시간에는 사용할 수 없습니다

## 📝 변경 이력

### v2.0 (2025-01-XX)

- 호가창 분석 강화 (스프레드/불균형/깊이)
- VWAP 기반 진입 판단 추가
- ATR 변동성 필터 추가
- 수수료 고려한 청산 기준 최적화
- API 캐싱으로 429 에러 방지
- 실제 수익률 계산 및 표시

### v1.0

- 기본 스캘핑 기능 구현
- RSI, Volume, Candle 전략
- 손절/익절/트레일링 스탑
- 대시보드 표시

## 🤝 문의

이슈 및 개선 제안은 GitHub Issues를 이용해 주세요.

## 📄 라이선스

MIT License
